<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Making your first Scratch Phaser 3 Game</title>
    <script src="lib/phaser.min.js"></script>
    <script src="lib/scratch_game.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>

<body>

    <script type="text/javascript">
        let game = new ScratchGame(800, 600);
        game.preload = preload;
        game.create = create;
        game.update = update;

        let player;
        let text1;
        let text2;

        let destinationX = 0;
        let destinationY = 0;
        let startX = 0;
        let startY = 0;
        let time = 0;
        let destinationTime = 0;
        let onMove = false;

        function preload() {
            this.loadImage('sea', 'assets/sea.jpg');
            this.loadSpritesheet('dude', 'assets/dude.png', 32, 48);
        }

        function create() {
            this.changeBackground("sea");
            player = this.createSprite(400, 300, "dude");
            player.costume = 4;

            text1 = this.createText(480, 20, "Demo Game #02\nClick mouse to move");
            text1.font = 'Arial';
            text1.size = 24;
            text1.color = '#00FFFF';

            text2 = this.createText(10, 550, "");
            text2.color = '#FFFFFF';

            this.onMouseDown(function (event) {
                startX = player.x;
                startY = player.y;
                destinationX = event.x;
                destinationY = event.y;
                time = game.getTime();
                destinationTime = time + 1000;
                onMove = true;
                player.turnTo(destinationX, destinationY);
                // потому что мы хотим, чтоб голова была напралена в направлении движения, нам надо
                // довернуться ещё на 90 градусов
                player.turn(90);
            });
        }

        function update() {
            if (onMove) {
                let t = (game.getTime() - time) / (destinationTime - time);
                player.x = startX + (destinationX - startX) * t;
                player.y = startY + (destinationY - startY) * t;
                if (t >= 1) {
                    onMove = false;
                }
            }
            text2.text = "X: " + player.x + "\nY: " + player.y + "\nTime: " + game.getTime();
        }
    </script>
</body>